<section class="uk-section uk-section-small">
    <div class="uk-container">
    {%- if section.settings.title != blank -%}
        <h2 class="uk-text-center">{{ section.settings.title }}</h2>
    {%- endif -%}
    
    {%- if section.settings.blog != blank -%}
        {%- assign blog = blogs[section.settings.blog] -%}
        <div class="uk-grid-medium uk-grid-match uk-child-width-1-1 uk-child-width-1-{{ section.settings.posts_per_row }}@s uk-grid" uk-grid="">
            {%- for article in blog.articles limit: section.settings.post_limit -%}
                <div class="{% if forloop.first %}uk-first-column{% endif %}">
                    <a href="{{ article.url }}">
                        <article class="uk-card uk-card-default uk-card-small uk-article uk-overflow-hidden uk-box-shadow-hover-large uk-height-1-1 tm-ignore-container">
                            <div class="tm-ratio tm-ratio-16-9">
                                <figure class="tm-media-box uk-cover-container uk-margin-remove">
                                    {%- if article.image -%}
                                        {% render 'image', 
                                            image: article.image,
                                            image_class: "uk-cover",
                                            max_width: 680,
                                            max_height: 380,
                                            sizes: "(min-width: 768px) 50vw, 100vw",
                                            widths: "400, 500, 680, 800, 1000",
                                            loading: section.settings.image_loading,
                                            attributes: 'uk-cover'
                                        %}
                                    {%- else -%}
                                        <div class="uk-cover-container uk-width-1-1 uk-height-1-1 uk-background-muted uk-flex uk-flex-center uk-flex-middle">
                                            <span uk-icon="icon: file-text; ratio: 2"></span>
                                        </div>
                                    {%- endif -%}
                                </figure>
                            </div>
                            <div class="uk-card-body">
                                <div class="uk-article-body">
                                    <div class="uk-article-meta uk-margin-xsmall-bottom">
                                        <time>{{ article.published_at | date: section.settings.date_format }}</time>
                                    </div>
                                    <div>
                                        <h3 class="uk-margin-remove">{{ article.title }}</h3>
                                    </div>
                                    {%- if section.settings.show_excerpt -%}
                                        <div class="uk-margin-small-top">
                                            <p>
                                                {%- if article.excerpt != blank -%}
                                                    {{ article.excerpt | strip_html | truncatewords: section.settings.excerpt_length }}
                                                {%- else -%}
                                                    {{ article.content | strip_html | truncatewords: section.settings.excerpt_length }}
                                                {%- endif -%}
                                            </p>
                                        </div>
                                    {%- endif -%}
                                </div>
                            </div>
                        </article>
                    </a>
                </div>
            {%- endfor -%}
        </div>
        
        {%- if section.settings.show_view_all -%}
            <div class="uk-margin uk-text-center">
                <a class="uk-link-muted uk-text-uppercase tm-link-to-all" href="{{ blog.url }}">
                    <span>{{ section.settings.view_all_text }}</span>
                    <span uk-icon="icon: chevron-right; ratio: .75;" class="uk-icon"></span>
                </a>
            </div>
        {%- endif -%}
    {%- else -%}
        <div class="uk-alert uk-alert-warning uk-text-center">
            <p>{{ 'sections.featured_blog.onboarding_title' | t | default: 'Please select a blog in the section settings' }}</p>
        </div>
    {%- endif -%}
    </div>
</section>

{% schema %}
{
  "name": "Featured Blog",
  "class": "section-featured-blog",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Blog posts"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog"
    },
    {
      "type": "range",
      "id": "post_limit",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Posts to show"
    },
    {
      "type": "select",
      "id": "posts_per_row",
      "label": "Posts per row",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        }
      ],
      "default": "2"
    },
    {
      "type": "header",
      "content": "Post details"
    },
    {
      "type": "select",
      "id": "image_loading",
      "label": "Image loading",
      "options": [
        {
          "value": "lazy",
          "label": "Lazy load (better performance)"
        },
        {
          "value": "eager",
          "label": "Eager load (immediate loading)"
        }
      ],
      "default": "lazy",
      "info": "Lazy loading improves performance but use eager loading for above-the-fold content"
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show excerpt",
      "default": true
    },
    {
      "type": "range",
      "id": "excerpt_length",
      "min": 10,
      "max": 50,
      "step": 5,
      "default": 25,
      "label": "Excerpt length",
      "info": "Number of words"
    },
    {
      "type": "select",
      "id": "date_format",
      "label": "Date format",
      "options": [
        {
          "value": "%B %d, %Y",
          "label": "Month day, year (January 1, 2023)"
        },
        {
          "value": "%b %d, %Y",
          "label": "Short month day, year (Jan 1, 2023)"
        },
        {
          "value": "%d.%m.%Y",
          "label": "DD.MM.YYYY (01.01.2023)"
        },
        {
          "value": "%Y-%m-%d",
          "label": "YYYY-MM-DD (2023-01-01)"
        }
      ],
      "default": "%B %d, %Y"
    },
    {
      "type": "header",
      "content": "View All Link"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View all' link",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View all text",
      "default": "See all articles"
    }
  ],
  "presets": [
    {
      "name": "Featured Blog",
      "category": "Blog"
    }
  ]
}
{% endschema %}
