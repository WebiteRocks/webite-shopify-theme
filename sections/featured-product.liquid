{%- comment -%}
  Featured Product Section
  ========================
  A reusable section that can be added to any page to display a product
  with the same layout and features as the main product page.
  Perfect for homepage, landing pages, etc.

  Uses the product-detail snippet for consistent display across the site.
{%- endcomment -%}

<script src="{{ 'variant-picker.js' | asset_url }}" defer></script>
<script src="{{ 'quantity-selector.js' | asset_url }}" defer></script>

{%- if section.settings.product != blank -%}
  {%- assign featured_product = section.settings.product -%}

  <section class="uk-section {% if section.settings.section_padding == 'small' %}uk-section-small{% elsif section.settings.section_padding == 'large' %}uk-section-large{% endif %} {% if section.settings.background_color == 'muted' %}uk-section-muted{% elsif section.settings.background_color == 'primary' %}uk-section-primary uk-light{% endif %}">
    <div class="uk-container{% if section.settings.container_width == 'small' %} uk-container-small{% elsif section.settings.container_width == 'large' %} uk-container-large{% elsif section.settings.container_width == 'expand' %} uk-container-expand{% endif %}">
      
      {%- if section.settings.heading != blank -%}
        <div class="uk-text-center uk-margin-medium-bottom">
          <h2 class="uk-heading-small">{{ section.settings.heading }}</h2>
          {%- if section.settings.subheading != blank -%}
            <p class="uk-text-lead uk-text-muted">{{ section.settings.subheading }}</p>
          {%- endif -%}
        </div>
      {%- endif -%}

      {%- comment -%} Build settings from blocks {%- endcomment -%}
      {%- liquid
        assign show_rating = false
        assign show_variant_picker = false
        assign show_price = false
        assign show_buy_buttons = false
        assign show_quantity = true
        assign show_wishlist = true
        assign show_inventory = false
        assign show_eta = false
        assign eta_label = 'Estimated Arrival'
        assign show_shipping_info = false
        assign shipping_delivery_title = 'Delivery'
        assign shipping_delivery_text = 'In stock, free, tomorrow'
        assign shipping_pickup_title = 'Pick up from store'
        assign shipping_pickup_text = 'In stock, free, tomorrow'
        assign show_description = false
        assign show_specifications = false

        for block in section.blocks
          case block.type
            when 'rating'
              assign show_rating = true
            when 'variant_picker'
              assign show_variant_picker = true
            when 'price'
              assign show_price = true
            when 'buy_buttons'
              assign show_buy_buttons = true
              assign show_quantity = block.settings.show_quantity
              assign show_wishlist = block.settings.show_wishlist
            when 'inventory'
              assign show_inventory = true
            when 'eta'
              assign show_eta = true
              assign eta_label = block.settings.eta_label
            when 'shipping_info'
              assign show_shipping_info = true
              assign shipping_delivery_title = block.settings.delivery_title
              assign shipping_delivery_text = block.settings.delivery_text
              assign shipping_pickup_title = block.settings.pickup_title
              assign shipping_pickup_text = block.settings.pickup_text
            when 'description'
              assign show_description = true
            when 'specifications'
              assign show_specifications = true
          endcase
        endfor
      -%}

      {% render 'product-detail',
        product: featured_product,
        section_id: section.id,
        show_breadcrumb: false,
        show_title: section.settings.show_title,
        show_rating: show_rating,
        show_variant_picker: show_variant_picker,
        show_price: show_price,
        show_buy_buttons: show_buy_buttons,
        show_quantity: show_quantity,
        show_wishlist: show_wishlist,
        show_inventory: show_inventory,
        show_eta: show_eta,
        eta_label: eta_label,
        show_shipping_info: show_shipping_info,
        shipping_delivery_title: shipping_delivery_title,
        shipping_delivery_text: shipping_delivery_text,
        shipping_pickup_title: shipping_pickup_title,
        shipping_pickup_text: shipping_pickup_text,
        show_description: show_description,
        show_specifications: show_specifications,
        compact: false
      %}
    </div>
  </section>

{%- else -%}
  {%- comment -%} Show placeholder in editor {%- endcomment -%}
  {%- if request.design_mode -%}
    <section class="uk-section">
      <div class="uk-container">
        <div class="uk-placeholder uk-text-center uk-padding-large">
          <span uk-icon="icon: cart; ratio: 3" class="uk-text-muted"></span>
          <p class="uk-text-large uk-text-muted uk-margin-top">Select a product to display</p>
        </div>
      </div>
    </section>
  {%- endif -%}
{%- endif -%}

{% schema %}
{
  "name": "Featured Product",
  "tag": "section",
  "class": "featured-product-section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show product title above card",
      "default": false
    },
    {
      "type": "header",
      "content": "Section Layout"
    },
    {
      "type": "select",
      "id": "section_padding",
      "label": "Section padding",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "default", "label": "Default" },
        { "value": "large", "label": "Large" }
      ],
      "default": "default"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "default", "label": "Default" },
        { "value": "large", "label": "Large" },
        { "value": "expand", "label": "Full width" }
      ],
      "default": "default"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Background color",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "muted", "label": "Muted" },
        { "value": "primary", "label": "Primary" }
      ],
      "default": "default"
    }
  ],
  "blocks": [
    {
      "type": "rating",
      "name": "Rating",
      "limit": 1,
      "settings": []
    },
    {
      "type": "variant_picker",
      "name": "Variant picker",
      "limit": 1,
      "settings": []
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": []
    },
    {
      "type": "buy_buttons",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_quantity",
          "label": "Show quantity selector",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_wishlist",
          "label": "Show wishlist button",
          "default": true
        }
      ]
    },
    {
      "type": "inventory",
      "name": "Inventory",
      "limit": 1,
      "settings": []
    },
    {
      "type": "eta",
      "name": "ETA (Estimated Arrival)",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "eta_label",
          "label": "Label",
          "default": "Estimated Arrival"
        }
      ]
    },
    {
      "type": "shipping_info",
      "name": "Shipping info",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "delivery_title",
          "label": "Delivery title",
          "default": "Delivery"
        },
        {
          "type": "text",
          "id": "delivery_text",
          "label": "Delivery text",
          "default": "In stock, free, tomorrow"
        },
        {
          "type": "text",
          "id": "pickup_title",
          "label": "Pickup title",
          "default": "Pick up from store"
        },
        {
          "type": "text",
          "id": "pickup_text",
          "label": "Pickup text",
          "default": "In stock, free, tomorrow"
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": []
    },
    {
      "type": "specifications",
      "name": "Specifications",
      "limit": 1,
      "settings": []
    },
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "Featured Product",
      "blocks": [
        { "type": "rating" },
        { "type": "variant_picker" },
        { "type": "price" },
        { "type": "buy_buttons" },
        { "type": "description" }
      ]
    }
  ]
}
{% endschema %}
